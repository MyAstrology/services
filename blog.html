<script>
const params = new URLSearchParams(window.location.search);
const postSlug = params.get('post'); 

const blogContent = document.getElementById('blog-content');
blogContent.innerHTML = "⏳ পোস্ট লোড হচ্ছে...";

if (!postSlug) {
  blogContent.innerHTML = "❌ কোনো পোস্ট সিলেক্ট করা হয়নি!";
} else {
  fetch(`/src/content/blog/${postSlug}.md`)
    .then(res => {
      if (!res.ok) throw new Error("পোস্ট পাওয়া যায়নি!");
      return res.text();
    })
    .then(text => {
      // Frontmatter parse
      const match = /^---([\s\S]*?)---/.exec(text);
      let frontMatter = {};
      if (match) {
        const yaml = match[1].trim().split('\n');
        yaml.forEach(line => {
          const [key, value] = line.split(':');
          if (key && value) {
            frontMatter[key.trim()] = value.trim().replace(/^"|"$/g, '');
          }
        });
        text = text.replace(match[0], '');
      }

      // Title, Description, Image
      if (frontMatter.title) {
        document.title = frontMatter.title;
        document.getElementById('post-title').innerText = frontMatter.title;
      }
      if (frontMatter.description) {
        document.querySelector('meta[name="description"]').setAttribute('content', frontMatter.description);
      }
      if (frontMatter.image) {
        const img = document.getElementById('post-image');
        img.src = frontMatter.image.trim();
        img.style.display = 'block';
      }

      blogContent.innerHTML = marked.parse(text);
    })
    .catch(err => {
      blogContent.innerHTML = "❌ পোস্ট লোড করা যায়নি। ফাইল নেই বা সার্ভারে সমস্যা হচ্ছে।";
      console.error(err);
    });
}
</script>
